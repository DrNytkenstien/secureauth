#!/bin/bash

# SecureAuth Backend - Quick Start Script
# This script sets up the backend project for development

set -e

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘          SecureAuth Backend - Quick Start Setup           â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# Check if Node.js is installed
if ! command -v node &> /dev/null; then
    echo "âŒ Node.js is not installed. Please install Node.js 18+ first."
    echo "   Download from: https://nodejs.org/"
    exit 1
fi

echo "âœ… Node.js found: $(node --version)"
echo ""

# Check if npm is installed
if ! command -v npm &> /dev/null; then
    echo "âŒ npm is not installed."
    exit 1
fi

echo "âœ… npm found: $(npm --version)"
echo ""

# Install dependencies
echo "ğŸ“¦ Installing dependencies..."
npm install

echo ""
echo "âš™ï¸  Creating .env file..."

# Check if .env already exists
if [ -f ".env" ]; then
    echo "âš ï¸  .env file already exists. Skipping creation."
else
    # Copy .env.example to .env
    if [ -f ".env.example" ]; then
        cp .env.example .env
        echo "âœ… .env file created from .env.example"
        echo "   Please edit .env with your configuration"
    else
        echo "âš ï¸  .env.example not found"
    fi
fi

echo ""
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘                    Setup Complete! ğŸ‰                      â•‘"
echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
echo "â•‘                                                            â•‘"
echo "â•‘  Next Steps:                                              â•‘"
echo "â•‘  1. Configure .env with your settings                     â•‘"
echo "â•‘  2. Start development server: npm run dev                 â•‘"
echo "â•‘  3. Server will run on http://localhost:5000              â•‘"
echo "â•‘                                                            â•‘"
echo "â•‘  Documentation:                                           â•‘"
echo "â•‘  - README.md              - API Documentation             â•‘"
echo "â•‘  - API_TESTING.md         - Testing Examples              â•‘"
echo "â•‘  - PRODUCTION_CHECKLIST.md - Production Deployment        â•‘"
echo "â•‘                                                            â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# Ask if user wants to start the server
read -p "Would you like to start the development server now? (y/n) " -n 1 -r
echo ""

if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo ""
    echo "ğŸš€ Starting development server..."
    echo ""
    npm run dev
fi
